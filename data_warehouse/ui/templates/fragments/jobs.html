<div class="jobs-shell">
    <div class="jobs-header">
        <strong>Jobs</strong>
        <span>{{ active | length }} active · {{ total }} total</span>
    </div>
    {% if jobs %}
    <ul class="jobs-list">
        {% for job in jobs %}
        <li>
            <span class="job-type">{{ job.job_type }}</span>
            <a class="job-id" href="/api/data-warehouse/jobs/{{ job.job_id }}">{{ job.job_id }}</a>
            <span class="job-status {{ job.status }}">{{ job.status }}</span>
            <div class="job-meta">
                <span>Created: {{ job.created_at | datetimeformat }}</span>
                <span>Updated: {{ job.updated_at | datetimeformat }}</span>
                {% if job.progress_pct is defined %}
                <span>Progress: {{ job.progress_pct }}%</span>
                {% endif %}
                {% if job.processed_count is defined and job.total_count is defined %}
                <span>Processed: {{ job.processed_count }}/{{ job.total_count }}</span>
                {% endif %}
                {% if job.current_ticker %}
                <span>
                    Current: {{ job.current_ticker }}
                    {% if job.current_timeframe %}({{ job.current_timeframe }}){% endif %}
                </span>
                {% endif %}
                {% if job.selected_range %}
                <span>
                    Range: {{ job.selected_range.start_epoch }} → {{ job.selected_range.end_epoch }}
                </span>
                {% endif %}
                {% if job.gap_count is defined %}
                <span>Gaps: {{ job.gap_count }}</span>
                {% endif %}
                {% if job.common_gap_count is defined %}
                <span>Common gaps: {{ job.common_gap_count }}</span>
                {% endif %}
                {% if job.excluded_common_gap_count is defined %}
                <span>Excluded common: {{ job.excluded_common_gap_count }}</span>
                {% endif %}
                {% if job.fetched_count is defined %}
                <span>Fetched: {{ job.fetched_count }}</span>
                {% endif %}
                {% if job.current_gap %}
                <span>
                    Gap: {{ job.current_gap.start_epoch }} → {{ job.current_gap.end_epoch }}
                </span>
                {% endif %}
                {% if job.inserted is defined %}
                <span>Inserted: {{ job.inserted }}</span>
                {% endif %}
                {% if job.deleted is defined %}
                <span>Deleted: {{ job.deleted }}</span>
                {% endif %}
                {% if job.error %}
                <span>Error: {{ job.error }}</span>
                {% endif %}
            </div>
        </li>
        {% endfor %}
    </ul>
    <div class="pagination">
        <button
            hx-get="/data-warehouse/fragments/jobs"
            hx-include="#filter-status, #filter-type, #jobs-page, #jobs-limit"
            hx-target="#jobs-panel"
            hx-swap="innerHTML"
            onclick="document.getElementById('jobs-page').value = Math.max(1, parseInt(document.getElementById('jobs-page').value) - 1);"
        >
            Prev
        </button>
        <span>Page {{ page }} of {{ total_pages }}</span>
        <button
            hx-get="/data-warehouse/fragments/jobs"
            hx-include="#filter-status, #filter-type, #jobs-page, #jobs-limit"
            hx-target="#jobs-panel"
            hx-swap="innerHTML"
            onclick="document.getElementById('jobs-page').value = Math.min({{ total_pages }}, parseInt(document.getElementById('jobs-page').value) + 1);"
        >
            Next
        </button>
    </div>
    {% else %}
    <div class="jobs-empty">No jobs found</div>
    {% endif %}
</div>
